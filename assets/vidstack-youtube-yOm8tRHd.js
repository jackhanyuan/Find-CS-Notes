import{ad as f,z as g,av as c,aw as v,e as p,ai as b,k as $,ax as S,ao as u,ay as T}from"./vidstack-UGaMhNs3-oMaa63Ea.js";import{E as j,t as m}from"./vidstack-ZXJzvCCj-WBa9eMGD.js";import"./app-vmUhBKiq.js";const h={wc:-1,oa:0,ra:1,ua:2,sa:3,ta:5},n=class n extends j{constructor(){super(...arguments),this.$$PROVIDER_TYPE="YOUTUBE",this.scope=f(),this.f=g(""),this.ha=-1,this.ia=-1,this.j=0,this.k=new c(0,0),this.n=null,this.d=null,this.e=null,this.language="en",this.color="red",this.cookies=!1}get a(){return this.b.delegate.a}get currentSrc(){return this.n}get type(){return"youtube"}get videoId(){return this.f()}preconnect(){const t=[this.p(),"https://www.google.com","https://i.ytimg.com","https://googleads.g.doubleclick.net","https://static.doubleclick.net"];for(const s of t)v(s,"preconnect")}setup(t){this.b=t,super.setup(t),p(this.z.bind(this)),p(this.la.bind(this)),this.a("provider-setup",this)}async play(){const{paused:t}=this.b.$state;if(b(t))return this.d||(this.d=m(()=>{if(this.d=null,t())return"Timed out."}),this.c("playVideo")),this.d.promise}async pause(){const{paused:t}=this.b.$state;if(!b(t))return this.e||(this.e=m(()=>{this.e=null,t()}),this.c("pauseVideo")),this.e.promise}setMuted(t){t?this.c("mute"):this.c("unMute")}setCurrentTime(t){this.c("seekTo",t)}setVolume(t){this.c("setVolume",t*100)}setPlaybackRate(t){this.c("setPlaybackRate",t)}async loadSource(t){var e;if(!$(t.src)){this.n=null,this.f.set("");return}const s=(e=t.src.match(n.v))==null?void 0:e[1];this.f.set(s??""),this.n=t}p(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}z(){this.q();const t=this.f();if(!t){this.r.set("");return}this.r.set(`${this.p()}/embed/${t}`)}la(){const t=this.f(),s=n.ja;if(!t)return;if(s.has(t)){const i=s.get(t);this.a("poster-change",i);return}const e=new AbortController;return this.ma(t,e),()=>{e.abort()}}async ma(t,s){try{const e=["maxresdefault","sddefault","hqdefault"];for(const i of e)for(const o of[!0,!1]){const a=this.na(t,i,o);if((await fetch(a,{mode:"no-cors",signal:s.signal})).status<400){n.ja.set(t,a),this.a("poster-change",a);return}}}catch{}this.a("poster-change","")}na(t,s,e){return`https://i.ytimg.com/${e?"vi_webp":"vi"}/${t}/${s}.${e?"webp":"jpg"}`}S(){const{keyDisabled:t}=this.b.$props,{$iosControls:s}=this.b,{controls:e,muted:i,playsinline:o}=this.b.$state,a=e()||s();return{autoplay:0,cc_lang_pref:this.language,cc_load_policy:a?1:void 0,color:this.color,controls:a?1:0,disablekb:!a||t()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:a?1:3,mute:i()?1:0,playsinline:o()?1:0}}c(t,s){this._({event:"command",func:t,args:s?[s]:void 0})}Z(){window.setTimeout(()=>this._({event:"listening"}),100)}E(t){this.b.delegate.U(void 0,t)}I(t){var s;(s=this.e)==null||s.resolve(),this.e=null,this.a("pause",void 0,t)}C(t,s){const{duration:e,currentTime:i}=this.b.$state,o=this.ha===h.oa?e():t,a={currentTime:o,played:this.j>=o?this.k:this.k=new c(0,this.j=t)};this.a("time-update",a,s),Math.abs(o-i())>1&&this.a("seeking",o,s)}ka(t,s,e){const i={buffered:new c(0,t),seekable:s};this.a("progress",i,e);const{seeking:o,currentTime:a}=this.b.$state;o()&&t>a()&&this.D(e)}D(t){const{paused:s,currentTime:e}=this.b.$state;window.clearTimeout(this.ia),this.ia=window.setTimeout(()=>{this.a("seeked",e(),t),this.ia=-1},s()?100:0)}pa(t){const{seeking:s}=this.b.$state;s()&&this.D(t),this.a("end",void 0,t)}qa(t,s){var a;const{paused:e}=this.b.$state,i=t===h.ra,o=t===h.sa;switch(o&&this.a("waiting",void 0,s),e()&&(o||i)&&((a=this.d)==null||a.resolve(),this.d=null,this.a("play",void 0,s)),t){case h.ta:this.E(s);break;case h.ra:this.a("playing",void 0,s);break;case h.ua:this.I(s);break;case h.oa:this.pa(s);break}this.ha=t}Y({info:t},s){var a;if(!t)return;const{title:e,duration:i,playbackRate:o}=this.b.$state;if(S(t.videoData)&&t.videoData.title!==e()&&this.a("title-change",t.videoData.title,s),u(t.duration)&&t.duration!==i()){if(u(t.videoLoadedFraction)){const r=((a=t.progressState)==null?void 0:a.loaded)??t.videoLoadedFraction*t.duration,l=new c(0,t.duration);this.ka(r,l,s)}this.a("duration-change",t.duration,s)}if(u(t.playbackRate)&&t.playbackRate!==o()&&this.a("rate-change",t.playbackRate,s),t.progressState){const{current:r,seekableStart:l,seekableEnd:k,loaded:w,duration:d}=t.progressState;this.C(r,s),this.ka(w,new c(l,k),s),d!==i()&&this.a("duration-change",d,s)}if(u(t.volume)&&T(t.muted)){const r={muted:t.muted,volume:t.volume/100};this.a("volume-change",r,s)}u(t.playerState)&&t.playerState!==this.ha&&this.qa(t.playerState,s)}q(){this.ha=-1,this.ia=-1,this.j=0,this.k=new c(0,0),this.d=null,this.e=null}};n.v=/(?:youtu\.be|youtube|youtube\.com|youtube-nocookie\.com)\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=|)((?:\w|-){11})/,n.ja=new Map;let y=n;export{y as YouTubeProvider};
