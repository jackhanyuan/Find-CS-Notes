import{ad as n,o as d,s as o,ae as c,k as u,af as l,e as f,l as h,ag as p,ah as m,ai as g,aj as k,ak as b,al as y,am as e}from"./vidstack-UGaMhNs3-oMaa63Ea.js";import{R as T}from"./vidstack-4poYsikJ-MXwFu5ml.js";class B{constructor(t,i){this.eb=l(),this.Db=!1,this.Eb=!1,this.Fb=!1,this.o=new T(this.y.bind(this)),this.Jb=void 0,this._b=void 0,this.Hb=t,this.b=i,this.Kb(),f(this.Lb.bind(this)),d(this.pb.bind(this))}get h(){return this.Hb.media}get a(){return this.b.delegate.a}pb(){this.Eb=!1,this.Fb=!1,this.o.$(),this.eb.empty()}y(){const t=this.h.currentTime;this.b.$state.currentTime()!==t&&this.Cb(t)}Kb(){this.Bb("loadstart",this.Mb),this.Bb("abort",this.Ib),this.Bb("emptied",this.Nb),this.Bb("error",this.Q)}Ob(){this.Eb||(this.eb.add(this.Bb("loadeddata",this.Pb),this.Bb("loadedmetadata",this.Qb),this.Bb("canplay",this.Rb),this.Bb("canplaythrough",this.Sb),this.Bb("durationchange",this.Tb),this.Bb("play",this.J),this.Bb("progress",this.ka),this.Bb("stalled",this.Ub),this.Bb("suspend",this.Vb)),this.Eb=!0)}Wb(){this.Fb||(this.eb.add(this.Bb("pause",this.I),this.Bb("playing",this.Xb),this.Bb("ratechange",this.Yb),this.Bb("seeked",this.D),this.Bb("seeking",this.Zb),this.Bb("ended",this.pa),this.Bb("volumechange",this.t),this.Bb("waiting",this.N)),this.Fb=!0)}Bb(t,i){return h(this.h,t,i.bind(this))}$b(t){}Cb(t,i){const s={currentTime:Math.min(t,this.b.$state.seekableEnd()),played:this.h.played};this.a("time-update",s,i)}Mb(t){if(this.h.networkState===3){this.Ib(t);return}this.Ob(),this.a("load-start",void 0,t)}Ib(t){this.a("abort",void 0,t)}Nb(){this.a("emptied",void 0,event)}Pb(t){this.a("loaded-data",void 0,t)}Qb(t){this.Wb(),this.a("loaded-metadata",void 0,t),p&&m(this.b.$state.source())&&this.b.delegate.U(this.Gb(),t)}Gb(){return{provider:g(this.b.$provider),duration:this.h.duration,buffered:this.h.buffered,seekable:this.h.seekable}}J(t){this.b.$state.canPlay&&this.a("play",void 0,t)}I(t){this.h.readyState===1&&!this.Db||(this.Db=!1,this.o.$(),this.a("pause",void 0,t))}Rb(t){this.b.delegate.U(this.Gb(),t)}Sb(t){this.b.$state.started()||this.a("can-play-through",this.Gb(),t)}Xb(t){this.Db=!1,this.a("playing",void 0,t),this.o.T()}Ub(t){this.a("stalled",void 0,t),this.h.readyState<3&&(this.Db=!0,this.a("waiting",void 0,t))}N(t){this.h.readyState<3&&(this.Db=!0,this.a("waiting",void 0,t))}pa(t){this.o.$(),this.Cb(this.h.duration,t),this.a("end",void 0,t),this.b.$state.loop()&&k(this.h.controls)&&(this.h.controls=!1)}Lb(){this.b.$state.paused()&&h(this.h,"timeupdate",this.C.bind(this))}C(t){this.Cb(this.h.currentTime,t)}Tb(t){this.b.$state.ended()&&this.Cb(this.h.duration,t),this.a("duration-change",this.h.duration,t)}t(t){const i={volume:this.h.volume,muted:this.h.muted};this.a("volume-change",i,t)}D(t){this.Cb(this.h.currentTime,t),this.a("seeked",this.h.currentTime,t),Math.trunc(this.h.currentTime)===Math.trunc(this.h.duration)&&b(this.h.duration)>b(this.h.currentTime)&&(this.Cb(this.h.duration,t),this.h.ended||this.b.player.dispatch(new y("media-play-request",{trigger:t})))}Zb(t){this.a("seeking",this.h.currentTime,t)}ka(t){const i={buffered:this.h.buffered,seekable:this.h.seekable};this.a("progress",i,t)}Vb(t){this.a("suspend",void 0,t)}Yb(t){this.a("rate-change",this.h.playbackRate,t)}Q(t){const i=this.h.error;if(!i)return;const s={message:i.message,code:i.code,mediaError:i};this.a("error",s,t)}}class v{constructor(t,i){this.Hb=t,this.b=i,this.ac.onaddtrack=this.cc.bind(this),this.ac.onremovetrack=this.dc.bind(this),this.ac.onchange=this.ec.bind(this),h(this.b.audioTracks,"change",this.fc.bind(this))}get ac(){return this.Hb.media.audioTracks}cc(t){const i=t.track;if(i.label==="")return;const s={id:i.id+"",label:i.label,language:i.language,kind:i.kind,selected:!1};this.b.audioTracks[e.W](s,t),i.enabled&&(s.selected=!0)}dc(t){const i=this.b.audioTracks.getById(t.track.id);i&&this.b.audioTracks[e.Aa](i,t)}ec(t){let i=this.bc();if(!i)return;const s=this.b.audioTracks.getById(i.id);s&&this.b.audioTracks[e.O](s,!0,t)}bc(){return Array.from(this.ac).find(t=>t.enabled)}fc(t){const{current:i}=t.detail;if(!i)return;const s=this.ac.getTrackById(i.id);if(s){const r=this.bc();r&&(r.enabled=!1),s.enabled=!0}}}class ${constructor(t){this.scope=n(),this.n=null,this.h=t}setup(t){new B(this,t),"audioTracks"in this.media&&new v(this,t),d(()=>{this.h.setAttribute("src",""),this.h.load()})}get type(){return""}get media(){return this.h}get currentSrc(){return this.n}setPlaybackRate(t){this.h.playbackRate=t}async play(){return this.h.play()}async pause(){return this.h.pause()}setMuted(t){this.h.muted=t}setVolume(t){this.h.volume=t}setCurrentTime(t){this.h.currentTime=t}setPlaysinline(t){o(this.h,"playsinline",t)}async loadSource({src:t,type:i},s){this.h.preload=s||"",c(t)?this.h.srcObject=t:(this.h.srcObject=null,this.h.src=u(t)?t:window.URL.createObjectURL(t)),this.h.load(),this.n={src:t,type:i}}}export{$ as H};
